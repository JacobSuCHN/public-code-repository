require("dotenv").config();
const express = require("express");
const { OpenAI } = require("openai");
const cors = require("cors");

const app = express();
app.use(cors());
app.use(express.json()); // è§£æž JSON è¯·æ±‚ä½“

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
  baseURL: "https://dashscope.aliyuncs.com/compatible-mode/v1",
});
const markdownContent =
  "ä»¥ä¸‹æ˜¯è¿‘10å¹´ï¼ˆ2015å¹´è‡³2024å¹´ï¼‰ç”·å­å…¨ç¨‹é©¬æ‹‰æ¾ï¼ˆFull Marathonï¼‰çš„ä¸–ç•Œæœ€å¥½æˆç»©ï¼ˆå³ä¸–ç•Œçºªå½•ï¼‰åŠå…¶åˆ›é€ è€…çš„ä¿¡æ¯ï¼š\n\n---\n\n### ðŸƒâ€â™‚ï¸ ç”·å­é©¬æ‹‰æ¾ä¸–ç•Œçºªå½•æ¼”å˜ï¼ˆ2015â€“2024ï¼‰\n\n| å¹´ä»½ | è¿åŠ¨å‘˜ | å›½ç± | æ¯”èµ›åç§° | æˆç»© | å¤‡æ³¨ |\n|------|--------|------|-----------|-------|------|\n| **2018** | **Eliud Kipchoge**ï¼ˆåŸƒé²å¾·Â·åŸºæ™®ä¹”æ ¼ï¼‰ | è‚¯å°¼äºš | æŸæž—é©¬æ‹‰æ¾ | **2:01:39** | æ‰“ç ´åŽŸä¸–ç•Œçºªå½•ï¼ˆ2:02:57ï¼‰ |\n| **2023** | **Kelvin Kiptum**ï¼ˆå‡¯å°”æ–‡Â·åŸºæ™®å›¾å§†ï¼‰ | è‚¯å°¼äºš | èŠåŠ å“¥é©¬æ‹‰æ¾ | **2:00:35** | æ–°ä¸–ç•Œçºªå½•ï¼ˆæ‰“ç ´2:01å¤§å…³ï¼‰ |\n\n---\n\n### ðŸ“Œ è¯´æ˜Žï¼š\n\n- **2015å¹´ä¹‹å‰**çš„ä¸–ç•Œçºªå½•ä¸º **Dennis Kimetto**ï¼ˆè‚¯å°¼äºšï¼‰äºŽ2014å¹´åœ¨æŸæž—é©¬æ‹‰æ¾åˆ›é€ çš„ **2:02:57**ã€‚\n- **2018å¹´**ï¼Œ**åŸºæ™®ä¹”æ ¼**ï¼ˆEliud Kipchogeï¼‰åœ¨æŸæž—é©¬æ‹‰æ¾ä»¥ **2:01:39** åˆ·æ–°ä¸–ç•Œçºªå½•ï¼Œè¢«è®¤ä¸ºæ˜¯é©¬æ‹‰æ¾è¿›å…¥â€œ2å°æ—¶01åˆ†â€æ—¶ä»£çš„é‡è¦æ ‡å¿—ã€‚\n- **2023å¹´9æœˆ**ï¼Œ**å‡¯å°”æ–‡Â·åŸºæ™®å›¾å§†**ï¼ˆKelvin Kiptumï¼‰åœ¨**èŠåŠ å“¥é©¬æ‹‰æ¾**ä»¥ **2:00:35** åˆ›ä¸‹æ–°çš„ä¸–ç•Œçºªå½•ï¼Œæˆä¸ºé¦–ä½åœ¨æ­£å¼æ¯”èµ›ä¸­è·‘è¿›**2å°æ—¶01åˆ†**çš„é€‰æ‰‹ã€‚\n- åŸºæ™®å›¾å§†åœ¨2024å¹´2æœˆå› é£žæœºå¤±äº‹ä¸å¹¸åŽ»ä¸–ï¼Œå¹´ä»…24å²ã€‚\n\n---\n\n### ðŸ† å…¶ä»–å€¼å¾—ä¸€æçš„æˆç»©ï¼š\n\n- **Breaking2 é¡¹ç›®ï¼ˆ2017å¹´ï¼‰**ï¼šåŸºæ™®ä¹”æ ¼åœ¨NIKEç»„ç»‡çš„â€œç ´2è®¡åˆ’â€ä¸­ï¼Œä»¥**2:00:25**å®Œæˆé©¬æ‹‰æ¾ï¼Œä½†å› éžæ­£å¼æ¯”èµ›ã€ä½¿ç”¨é…é€Ÿå›¢é˜Ÿå’Œè®¾å¤‡è¾…åŠ©ï¼Œ**ä¸è¢«å›½é™…ç”°è”æ‰¿è®¤**ä¸ºä¸–ç•Œçºªå½•ã€‚\n- **2020å¹´ä¼¦æ•¦é©¬æ‹‰æ¾**ï¼šShura Kitataï¼ˆåŸƒå¡žä¿„æ¯”äºšï¼‰ä»¥**2:05:44**å¤ºå† ï¼Œæ˜¯å½“å¹´æœ€å¿«çš„æ­£å¼æ¯”èµ›æˆç»©ã€‚\n- **2022å¹´æŸæž—é©¬æ‹‰æ¾**ï¼šåŸºæ™®ä¹”æ ¼ä»¥**2:01:09**å†æ¬¡é€¼è¿‘ä¸–ç•Œçºªå½•ã€‚\n\n---\n\n### ðŸ§  å°çŸ¥è¯†ï¼š\n\n- é©¬æ‹‰æ¾ä¸–ç•Œçºªå½•çš„æå‡éžå¸¸å›°éš¾ï¼Œæ¯ç§’çš„è¿›æ­¥éƒ½ä»£è¡¨äººç±»æžé™çš„çªç ´ã€‚\n- ç›®å‰ç”·å­é©¬æ‹‰æ¾ä¸–ç•Œçºªå½•ä¸º **2:00:35**ï¼ˆå‡¯å°”æ–‡Â·åŸºæ™®å›¾å§†ï¼Œ2023å¹´ï¼‰ã€‚\n\n---\n\nå¦‚éœ€äº†è§£å¥³å­é©¬æ‹‰æ¾çºªå½•ã€å„å¹´ä»½èµ›äº‹æˆç»©æˆ–ä¸åŒå›½å®¶é€‰æ‰‹è¡¨çŽ°ï¼Œä¹Ÿå¯ä»¥ç»§ç»­é—®æˆ‘ï¼";
// ä»£ç† OpenAI èŠå¤©æŽ¥å£
app.post("/api/chat", async (req, res) => {
  try {
    const { message } = req.body;
    const completion = await openai.chat.completions.create({
      model: "qwen-plus",
      messages: [{ role: "user", content: message }],
    });
    res.json({ content: completion.choices[0].message.content });
  } catch (error) {
    console.error("OpenAI  API Error:", error);
    res.status(500).json({ error: error.message });
  }
});

app.get("/api/chart", async (req, res) => {
  try {
    res.json({
      content: markdownContent,
    });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server  running on http://localhost:${PORT}`);
});
